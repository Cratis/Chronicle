/** @license
 *
 *  Copyright (C) 2012 K. Arthur Endsley (kaendsle@mtu.edu)
 *  Michigan Tech Research Institute (MTRI)
 *  3600 Green Court, Suite 100, Ann Arbor, MI, 48105
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 *//**
 * @augments Wkt.Wkt
 * A framework-dependent flag, set for each Wkt.Wkt() instance, that indicates
 * whether or not a closed polygon geometry should be interpreted as a rectangle.
 */Wkt.Wkt.prototype.isRectangle=!1,Wkt.Wkt.prototype.trunc=function(e){var t,n=[];for(t=0;t<e.length;t+=1)Wkt.isArray(e[t])?n.push(this.trunc(e[t])):(t===0||!this.sameCoords(e[0],e[t]))&&n.push(e[t]);return n},Wkt.Wkt.prototype.construct={point:function(e,t){var n=t||this.components;return n instanceof Array&&(n=n[0]),L.marker(this.coordsToLatLng(n),e)},multipoint:function(e){var t,n=[],r=this.components;for(t=0;t<r.length;t+=1)n.push(this.construct.point.call(this,e,r[t]));return L.featureGroup(n,e)},linestring:function(e,t){var n=t||this.components,r=this.coordsToLatLngs(n);return L.polyline(r,e)},multilinestring:function(e){var t=this.components,n=this.coordsToLatLngs(t,1);return L.multiPolyline(n,e)},polygon:function(e){var t=this.trunc(this.components),n=this.coordsToLatLngs(t,1);return L.polygon(n,e)},multipolygon:function(e){var t=this.trunc(this.components),n=this.coordsToLatLngs(t,2);return L.multiPolygon(n,e)},geometrycollection:function(e){var t,n,r;t=this.trunc(this.components),r=[];for(n=0;n<this.components.length;n+=1)r.push(this.construct[t[n].type].call(this,t[n]));return L.featureGroup(r,e)}},L.Util.extend(Wkt.Wkt.prototype,{coordsToLatLngs:L.GeoJSON.coordsToLatLngs,coordsToLatLng:function(e,t){var n=t?e.x:e.y,r=t?e.y:e.x;return L.latLng(n,r,!0)}}),Wkt.Wkt.prototype.deconstruct=function(e){var t,n,r,i,s,o,u;n=function(e){var t,r;r=[];for(t=0;t<e.length;t+=1)Wkt.isArray(e[t])?r.push(n(e[t])):r.push({x:e[t].lng,y:e[t].lat});return r};if(e.constructor===L.Marker||e.constructor===L.marker)return{type:"point",components:[{x:e.getLatLng().lng,y:e.getLatLng().lat}]};if(e.constructor===L.Rectangle||e.constructor===L.rectangle)return u=e.getBounds(),{type:"polygon",isRectangle:!0,components:[[{x:u.getSouthWest().lng,y:u.getNorthEast().lat},{x:u.getNorthEast().lng,y:u.getNorthEast().lat},{x:u.getNorthEast().lng,y:u.getSouthWest().lat},{x:u.getSouthWest().lng,y:u.getSouthWest().lat},{x:u.getSouthWest().lng,y:u.getNorthEast().lat}]]};if(e.constructor===L.Polyline||e.constructor===L.polyline){s=[],u=e.getLatLngs();if(!u[0].equals(u[u.length-1])){for(i=0;i<u.length;i+=1)s.push({x:u[i].lng,y:u[i].lat});return{type:"linestring",components:s}}}if(e.constructor===L.Polygon||e.constructor===L.polygon){o=[],s=[],u=e.getLatLngs();for(i=0;i<e._latlngs.length;i+=1)s.push({x:u[i].lng,y:u[i].lat});s.push({x:u[0].lng,y:u[0].lat}),o.push(s);if(e._holes&&e._holes.length>0){s=n(e._holes);for(i=0;i<s.length;i++)s[i].push(s[i][0]),o.push(s[i])}return{type:"polygon",components:o}}if(e.constructor===L.MultiPolyline||e.constructor===L.MultiPolygon||e.constructor===L.LayerGroup||e.constructor===L.FeatureGroup){r=[],u=e._layers;for(t in u)u.hasOwnProperty(t)&&(u[t].getLatLngs||u[t].getLatLng)&&r.push(this.deconstruct(u[t]));return{type:function(){switch(e.constructor){case L.MultiPolyline:return"multilinestring";case L.MultiPolygon:return"multipolygon";case L.FeatureGroup:return function(){var t,n,r,i;n=!0,r=!0,i=!0;for(t in e._layers)e._layers.hasOwnProperty(t)&&(e._layers[t].constructor!==L.Marker&&(i=!1),e._layers[t].constructor!==L.Polyline&&(r=!1),e._layers[t].constructor!==L.Polygon&&(n=!1));return i?"multipoint":r?"multilinestring":n?"multipolygon":"geometrycollection"}();default:return"geometrycollection"}}(),components:function(){var e,t;t=[];for(e=0;e<r.length;e+=1)r[e].components&&t.push(r[e].components);return t}()}}e.constructor===L.Rectangle||e.constructor===L.rectangle?console.log("Deconstruction of L.Circle objects is not yet supported"):console.log("The passed object does not have any recognizable properties.")};