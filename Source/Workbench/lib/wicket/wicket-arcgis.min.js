/** @license
 *
 *  Copyright (C) 2012 K. Arthur Endsley (kaendsle@mtu.edu)
 *  Michigan Tech Research Institute (MTRI)
 *  3600 Green Court, Suite 100, Ann Arbor, MI, 48105
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 */Array.prototype.map||(Array.prototype.map=function(e){"use strict";var t,n,r,i;if(this===void 0||this===null)throw new TypeError;t=Object(this),n=t.length>>>0;if(typeof e!="function")throw new TypeError;r=new Array(n),i=arguments.length>=2?arguments[1]:void 0;for(var s=0;s<n;s++)s in t&&(r[s]=e.call(i,t[s],s,t));return r}),Wkt.Wkt.prototype.isRectangle=!1,Wkt.Wkt.prototype.construct={point:function(e,t){var n=t||this.components;return n instanceof Array&&(n=n[0]),e&&(n.spatialReference=e.spatialReference||e.srs),new esri.geometry.Point(n)},multipoint:function(e){return e=e||{},!e.spatialReference&&e.srs&&(e.spatialReference=e.srs),new esri.geometry.Multipoint({points:this.components.map(function(e){return Wkt.isArray(e)&&(e=e[0]),[e.x,e.y]}),spatialReference:e.spatialReference})},linestring:function(e){return e=e||{},!e.spatialReference&&e.srs&&(e.spatialReference=e.srs),new esri.geometry.Polyline({paths:[this.components.map(function(e){return[e.x,e.y]})],spatialReference:e.spatialReference})},multilinestring:function(e){return e=e||{},!e.spatialReference&&e.srs&&(e.spatialReference=e.srs),new esri.geometry.Polyline({paths:this.components.map(function(e){return e.map(function(e){return[e.x,e.y]})}),spatialReference:e.spatialReference})},polygon:function(e){return e=e||{},!e.spatialReference&&e.srs&&(e.spatialReference=e.srs),new esri.geometry.Polygon({rings:this.components.map(function(e){return e.map(function(e){return[e.x,e.y]})}),spatialReference:e.spatialReference})},multipolygon:function(e){var t=this;return e=e||{},!e.spatialReference&&e.srs&&(e.spatialReference=e.srs),new esri.geometry.Polygon({rings:function(){var e,n,r,i,s;r=!1,s=t.components.map(function(e){var t=e.map(function(e){return e.map(function(e){return[e.x,e.y]})});return r=t.length>1,t});if(!r&&s[0].length>1)return s;i=[];for(e=0;e<s.length;e+=1)if(s[e].length>1)for(n=0;n<s[e].length;n+=1)i.push(s[e][n]);else i.push(s[e][0]);return i}(),spatialReference:e.spatialReference})}},Wkt.isInnerRingOf=function(e,t,n){var r,i,s,o;r=!0,s=new esri.geometry.Polygon({rings:t.map(function(e){return e.map(function(e){return[e.x,e.y]})}),spatialReference:n});for(i=0;i<e.length;i+=1){o=new esri.geometry.Point(e[i].x,e[i].y,n);if(!s.contains(o)){r=!1;break}}return r},Wkt.Wkt.prototype.deconstruct=function(e){var t,n,r,i,s;if(e.constructor===esri.geometry.Point)return{type:"point",components:[{x:e.getLongitude(),y:e.getLatitude()}]};if(e.constructor===esri.geometry.Multipoint){s=[];for(t=0;t<e.points.length;t+=1)s.push([{x:e.points[t][0],y:e.points[t][1]}]);return{type:"multipoint",components:s}}if(e.constructor===esri.geometry.Polyline){r=[];for(t=0;t<e.paths.length;t+=1){s=[];for(n=0;n<e.paths[t].length;n+=1)s.push({x:e.paths[t][n][0],y:e.paths[t][n][1]});r.push(s)}return e.paths.length>1?{type:"multilinestring",components:r}:{type:"linestring",components:s}}if(e.constructor===esri.geometry.Polygon){i=[];for(t=0;t<e.rings.length;t+=1){s=[];for(n=0;n<e.rings[t].length;n+=1)s.push({x:e.rings[t][n][0],y:e.rings[t][n][1]});t>0?Wkt.isInnerRingOf(s,i[t-1],e.spatialReference)?i[i.length-1].push(s):i.push([s]):i.push([s])}return i.length>1?{type:"multipolygon",components:i}:{type:"polygon",components:i[0]}}};